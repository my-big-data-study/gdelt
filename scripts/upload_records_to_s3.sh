#!/usr/bin/env bash

REMOTE_CSV_DIR="s3://mhtang/data-learning-test/data/csvs"

list_of_zip_files=(
  "20200524054500.export.CSV.zip"
  #  "20200524060000.export.CSV.zip"
  #  "20200524061500.export.CSV.zip"
  #  "20200524063000.export.CSV.zip"
  #  "20200524064500.export.CSV.zip"
  #  "20200524070000.export.CSV.zip"
  #  "20200524071500.export.CSV.zip"
  #  "20200524073000.export.CSV.zip"
  #  "20200524074500.export.CSV.zip"
  #  "20200524080000.export.CSV.zip"
  #  "20200524081500.export.CSV.zip"
  #  "20200524083000.export.CSV.zip"
  #  "20200524084500.export.CSV.zip"
  #  "20200524090000.export.CSV.zip"
  #  "20200524091500.export.CSV.zip"
  #  "20200524093000.export.CSV.zip"
  #  "20200524094500.export.CSV.zip"
  #  "20200524100000.export.CSV.zip"
  #  "20200524101500.export.CSV.zip"
  #  "20200524103000.export.CSV.zip"
  #  "20200524104500.export.CSV.zip"
  #  "20200524110000.export.CSV.zip"
  #  "20200524111500.export.CSV.zip"
  #  "20200524113000.export.CSV.zip"
  #  "20200524114500.export.CSV.zip"
  #  "20200524120000.export.CSV.zip"
  #  "20200524121500.export.CSV.zip"
  #  "20200524123000.export.CSV.zip"
  #  "20200524124500.export.CSV.zip"
  #  "20200524130000.export.CSV.zip"
  #  "20200524131500.export.CSV.zip"
  #  "20200524133000.export.CSV.zip"
  #  "20200524134500.export.CSV.zip"
  #  "20200524140000.export.CSV.zip"
  #  "20200524141500.export.CSV.zip"
  #  "20200524143000.export.CSV.zip"
  #  "20200524144500.export.CSV.zip"
  #  "20200524150000.export.CSV.zip"
  #  "20200524151500.export.CSV.zip"
  #  "20200524153000.export.CSV.zip"
  #  "20200524154500.export.CSV.zip"
  #  "20200524160000.export.CSV.zip"
  #  "20200524161500.export.CSV.zip"
  #  "20200524163000.export.CSV.zip"
  #  "20200524164500.export.CSV.zip"
  #  "20200524170000.export.CSV.zip"
  #  "20200524171500.export.CSV.zip"
  #  "20200524173000.export.CSV.zip"
  #  "20200524174500.export.CSV.zip"
  #  "20200524180000.export.CSV.zip"
  #  "20200524181500.export.CSV.zip"
  #  "20200524183000.export.CSV.zip"
  #  "20200524184500.export.CSV.zip"
  #  "20200524190000.export.CSV.zip"
  #  "20200524191500.export.CSV.zip"
  #  "20200524193000.export.CSV.zip"
  #  "20200524194500.export.CSV.zip"
  #  "20200524200000.export.CSV.zip"
  #  "20200524201500.export.CSV.zip"
  #  "20200524203000.export.CSV.zip"
  #  "20200524204500.export.CSV.zip"
  #  "20200524210000.export.CSV.zip"
  #  "20200524211500.export.CSV.zip"
  #  "20200524213000.export.CSV.zip"
  #  "20200524214500.export.CSV.zip"
  #  "20200524220000.export.CSV.zip"
  #  "20200524221500.export.CSV.zip"
  #  "20200524223000.export.CSV.zip"
  #  "20200524224500.export.CSV.zip"
  #  "20200524230000.export.CSV.zip"
  #  "20200524231500.export.CSV.zip"
  #  "20200524233000.export.CSV.zip"
  #  "20200524234500.export.CSV.zip"
)

for file in "${list_of_zip_files[@]}"; do
  LOCAL_ZIP_FILE_PATH="./data/$file"
  rm -f "$LOCAL_ZIP_FILE_PATH"

  echo "Downloading and uploading $file"
  curl -o "$LOCAL_ZIP_FILE_PATH" "http://data.gdeltproject.org/gdeltv2/$file"

  CSV_FILE_NAME="${file/.zip/}"
  REMOTE_CSV_FILE_PATH="$REMOTE_CSV_DIR/$CSV_FILE_NAME"
  LOCAL_CSV_FILE_PATH="./data/$CSV_FILE_NAME"

  rm -f "$LOCAL_CSV_FILE_PATH"
  unzip -o "$LOCAL_ZIP_FILE_PATH" -d "./data"
  rm -f "$LOCAL_ZIP_FILE_PATH"

  aws --profile profile_tw s3 rm "$REMOTE_CSV_FILE_PATH"
  aws --profile profile_tw s3 cp "$LOCAL_CSV_FILE_PATH" "$REMOTE_CSV_FILE_PATH"
done

echo "Running EMR job"
./scripts/run_on_emr.sh "$REMOTE_CSV_FILE_PATH"
